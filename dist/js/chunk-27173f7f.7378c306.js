(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27173f7f"],{"17b2":function(e,t,n){"use strict";var a=n("5dbf"),o=n.n(a);o.a},"37ab":function(e,t,n){},"490a":function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return r}));var a=n("0c6d");function o(e){return Object(a["a"])({url:"/system/modules/all/tree",method:"get",params:e})}function l(e){return Object(a["a"])({url:"/system/modules/".concat(e.id),method:"delete"})}function i(e,t){return Object(a["a"])({url:"/system/modules",method:t?"put":"post",data:e})}function r(e){return Object(a["a"])({url:"/system/modules/".concat(e),method:"get"})}},5914:function(e,t,n){},"5dbf":function(e,t,n){},"91ae":function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return i}));var a=n("0c6d");function o(e,t){return Object(a["a"])({url:"/system/roles",method:t?"put":"post",data:e})}function l(e){return Object(a["a"])({url:"/system/roles/".concat(e),method:"get"})}function i(e){return Object(a["a"])({url:"/system/roles/".concat(e),method:"delete"})}},a38f:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-wraper"},[n("header",{staticClass:"section-title"},[e._v("基本信息")]),n("el-form",{ref:"userForm",attrs:{model:e.roleInfo,rules:e.rules,"label-width":"100px"}},[n("section",{staticClass:"section-main pd-l-10"},[n("el-col",{staticClass:"col",attrs:{span:12}},[n("el-form-item",{staticClass:"label",attrs:{label:"角色名称",prop:"name"}},[n("el-input",{staticClass:"width280-imp",model:{value:e.roleInfo.name,callback:function(t){e.$set(e.roleInfo,"name","string"===typeof t?t.trim():t)},expression:"roleInfo.name"}})],1),n("el-form-item",{staticClass:"label",attrs:{label:"状态",prop:"status"}},[n("status",{model:{value:e.roleInfo.status,callback:function(t){e.$set(e.roleInfo,"status",t)},expression:"roleInfo.status"}})],1)],1),n("el-col",{staticClass:"col",attrs:{span:12}},[n("el-form-item",{staticClass:"label",attrs:{label:"Code",prop:"code"}},[n("el-input",{staticClass:"width280-imp",model:{value:e.roleInfo.code,callback:function(t){e.$set(e.roleInfo,"code","string"===typeof t?t.trim():t)},expression:"roleInfo.code"}})],1)],1)],1)]),n("div",{staticClass:"permission"},[n("header",{staticClass:"section-title"},[e._v("权限信息")]),n("section",{staticClass:"pd-l-20"},[n("tree-table",{directives:[{name:"loading",rawName:"v-loading",value:e.bModulesLoading,expression:"bModulesLoading"}],ref:"modulesTable",attrs:{"default-value":e.roleInfo.moduleList,data:e.moduleList,columns:e.moduleColumns}},[n("el-table-column",{attrs:{slot:"selection",type:"selection",align:"center",width:"100px"},slot:"selection"})],1)],1)]),n("button-group",{staticClass:"op"},[n("el-button",{attrs:{type:"primary"},on:{click:e.fSave}},[e._v("保存")]),n("el-button",{on:{click:function(t){return e.$router.back()}}},[e._v("取消")])],1)],1)},o=[],l=(n("4160"),n("a15b"),n("d81d"),n("d3b7"),n("ac1f"),n("1276"),n("159b"),n("5530")),i=n("1b62"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",e._g(e._b({ref:"table",attrs:{data:e.formatData,"row-class-name":e.showRow},on:{"selection-change":e.fSelectionChange,select:e.fSelectRow}},"el-table",e.$attrs,!1),e.$listeners),[e._t("selection"),e.columns&&0!==e.columns.length?e._l(e.columns,(function(t,a){return n("el-table-column",{key:t.value,attrs:{label:t.text,width:t.width},scopedSlots:e._u([{key:"default",fn:function(o){return[0===a?n("span",e._l(o.row._level,(function(e){return n("span",{key:e,staticClass:"ms-tree-space"})})),0):e._e(),e.iconShow(a,o.row)?n("span",{staticClass:"tree-ctrl",on:{click:function(t){return t.stopPropagation(),e.toggleExpanded(o.$index)}}},[o.row._expanded?n("i",{staticClass:"el-icon-minus"}):n("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(o.row[t.value])+" "),e.$slots.selection&&e.iconShow(a,o.row)?n("span",{staticClass:"op"},[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.fSelectChildren(o.row)}}},[e._v("全选")]),n("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.fReverseChildren(o.row)}}},[e._v("反选")])],1):e._e()]}}],null,!0)})})):e._t("default")],2)},s=[],c=(n("99af"),n("a623"),n("caad"),n("277d"),n("b64b"),n("2532"),n("a630"),n("3ca3"),n("2b0e"));function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=[];return Array.from(e).forEach((function(e){void 0===e._expanded&&c["default"].set(e,"_expanded",t);var l=1;if(void 0!==a&&null!==a&&(l=a+1),c["default"].set(e,"_level",l),n&&c["default"].set(e,"parent",n),o.push(e),e.children&&e.children.length>0){var i=u(e.children,t,e,l);o=o.concat(i)}})),o}var d={name:"treeTable",props:{defaultValue:{type:Array,default:function(){return[]}},data:{type:[Array,Object],required:!0},columns:{type:Array,default:function(){return[]}},evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!1}},watch:{noLevelData:function(e){this.fSetDefaultValue()},defaultValue:function(){this.fSetDefaultValue()}},data:function(){return{aSelections:[]}},computed:{formatData:function(){var e;e=Array.isArray(this.data)?this.data:[this.data];var t=this.evalFunc||u,n=this.evalArgs?Array.concat([e,this.expandAll],this.evalArgs):[e,this.expandAll];return t.apply(null,n)},noLevelData:function(){var e={},t=function(t){t&&t.id&&(e[t.id]=t)};return this.formatData.forEach((function(e){t(e)})),e}},methods:{fSetDefaultValue:function(){var e=this;this.$nextTick((function(){e.defaultValue.length&&Object.keys(e.noLevelData).length&&e.defaultValue.forEach((function(t){e.noLevelData[t]&&e.toggleRowSelection(e.noLevelData[t],!0)}))}))},fSelectRow:function(e,t){var n=this.fIsChecked(t);n?this.fCheck(t):this.fUncheck(t)},fSelectionChange:function(e){this.aSelections=e},showRow:function(e){var t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"tree-show":"tree-hidden"},toggleExpanded:function(e){var t=this.formatData[e];t._expanded=!t._expanded},toggleExpandedAll:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.noLevelData)this.noLevelData[t]._expanded!==e&&(this.noLevelData[t]._expanded=e)},iconShow:function(e,t){return 0===e&&t.children&&t.children.length>0},toggleRowSelection:function(e,t){this.$refs.table.toggleRowSelection(e,t)},fGetSelection:function(){return this.aSelections},fIsChecked:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;Array.isArray(e)||(e=[e]);var a=e.every((function(e){return t.aSelections.includes(e)===n}));return a},fSelectChildren:function(e){var t=this;e.children&&e.children.length&&(this.fIsChecked(e)||this.toggleRowSelection(e,!0),e.children.forEach((function(e){t.fIsChecked(e)||t.toggleRowSelection(e,!0)})))},fReverseChildren:function(e){var t=this,n=0;e.children&&e.children.length&&(e.children.forEach((function(e){t.toggleRowSelection(e),t.fIsChecked(e)?n++:t.fUncheck(e)})),n?n===e.children.length&&!this.fIsChecked(e)&&this.toggleRowSelection(e,!0):this.fUncheck(e,!0))},fUncheck:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){this.toggleRowSelection(e,!1);var a=e.pid&&this.noLevelData[e.pid],o=a&&a.children;o&&this.fIsChecked(o,!1)&&this.fUncheck(a,!0),n||e.children&&e.children.length&&e.children.forEach((function(e){t.fUncheck(e)}))}},fCheck:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(this.fIsChecked(e)||this.toggleRowSelection(e,!0),t||e.pid&&this.noLevelData[e.pid]&&this.fCheck(this.noLevelData[e.pid]))},fReset:function(){var e=this.$refs.table;e.clearSelection(),this.toggleExpandedAll(!1)}}},f=d,h=(n("e9b3"),n("17b2"),n("2877")),m=Object(h["a"])(f,r,s,!1,null,"43883e52",null),p=m.exports,v=n("91ae"),g=n("490a"),b={mixins:[i["c"]],components:{TreeTable:p},data:function(){return{id:this.$route.params.id||null,bModulesLoading:!1,moduleColumns:[{text:"模块名称",value:"name"},{text:"URL",value:"url"}],moduleList:[],rules:{name:{required:!0,message:"角色名称不能为空",trigger:"blur"},code:{required:!0,message:"code不能为空",trigger:"blur"}},roleInfo:{status:0}}},created:function(){this.isEdit&&this.fGetRole(),this.fGetPermission()},methods:{fGetRole:function(){var e=this;Object(v["b"])(this.id).then((function(t){var n=t.data;if(!n)return e.$message({message:"无法查询到有效的角色信息！",type:"error"}),void e.fBack();e.roleInfo=Object(l["a"])({},n,{status:+n.status,moduleList:(n.moduleList||"").split(",").map((function(e){return e>>0}))})}))},fGetPermission:function(){var e=this;this.moduleList&&this.moduleList.length||(this.bModulesLoading=!0,Object(g["c"])({rootId:-1}).then((function(t){if(t.data){var n=function e(t){t.children=t.childModule,delete t.childModule,t.pid=t.parentId,t.children&&t.children.forEach(e)},a=t.data.rows||[];a.forEach(n),e.moduleList=a}}),(function(e){}))["finally"]((function(){e.bModulesLoading=!1})))},fSave:function(){var e=this;this.fVelidateForm(this.$refs.userForm,(function(){var t=e.fGetSelectedModules().map((function(e){return e.id})).join(","),n=Object(l["a"])({},e.roleInfo,{moduleList:t});Object(v["c"])(n,e.isCreate).then((function(t){e.$message({message:"修改成功！",type:"success"}),e.fBack()}))["catch"]((function(e){return console.log(e)}))}))},fGetSelectedModules:function(){return this.$refs.modulesTable.fGetSelection()}}},w=b,y=(n("be8f"),Object(h["a"])(w,a,o,!1,null,"20b2cfd8",null));t["default"]=y.exports},a623:function(e,t,n){"use strict";var a=n("23e7"),o=n("b727").every,l=n("a640"),i=n("ae40"),r=l("every"),s=i("every");a({target:"Array",proto:!0,forced:!r||!s},{every:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},be8f:function(e,t,n){"use strict";var a=n("5914"),o=n.n(a);o.a},e9b3:function(e,t,n){"use strict";var a=n("37ab"),o=n.n(a);o.a}}]);